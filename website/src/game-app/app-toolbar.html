<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<!--
    @author Robin Duda
    Polymer element for use as a footer.
 -->

<dom-module id="app-toolbar">
    <link rel="import" href="../style/theme.css" type="css">
    <link rel="import" href="../style/style.css" type="css">
    <template>
        <style>
            :host {
                display: block;
                width: 100%;
                position: fixed;
                top: 0;
                left: 0;
            }

            paper-material {
                display: block;
                border-radius: 0;
            }

            .header {
                display: block;
            }

            iron-icon {
                padding: 8px;
            }

            iron-icon:hover {
                cursor: pointer;
            }

            #banner {
                text-align: center;
                padding: 11.5px;
            }

            .banner-text {
                font-size: 12px;
                opacity: 0.76;
                margin: auto;
                display: block;
                width: 50%;
            }

            #home-icon {
                float: left;
            }
        </style>

        <paper-material class="header" elevation="3">
            <template is="dom-if" if="[[website]]">
                <iron-icon id="home-icon" icon="icons:home" on-down="_home"></iron-icon>
            </template>

            <template is="dom-if" if="[[loggedin]]">
                <iron-icon style="float:right;" icon="icons:close" on-down="_logout"></iron-icon>
            </template>


            <template is="dom-if" if="[[_banner(banner)]]">
                <div id="banner">
                    <span class="banner-text">[[banner.text]]</span>
                </div>
            </template>

        </paper-material>

        <iron-ajax auto url="src/data/banner.json" handle-as="json" last-response="{{banner}}"></iron-ajax>

    </template>
    <script>
        class AppToolbar extends Polymer.GestureEventListeners(Polymer.Element) {

            static get is() {
                return 'app-toolbar';
            }

            ready() {
                super.ready();
                this.website = !(window.isPWA);
                this.banner = {};

                application.subscribe('installed', installed => {
                    this.website = !installed;
                });

                application.onAuthentication(() => {
                    this.loggedin = true;
                });

                application.onLogout(() => {
                    this.loggedin = false;
                });
            }

            _banner() {
                return !!(this.banner.text);
            }

            _home() {
                application.view('start-page');
            }

            _logout() {
                if (window.isPWA) {
                    document.exitFullscreen();
                }
                application.logout();
            }
        }

        window.customElements.define(AppToolbar.is, AppToolbar);


    </script>
</dom-module>