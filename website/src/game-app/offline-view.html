<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<!--
    @author Robin Duda
    Polymer element to show when application is offline.
 -->

<dom-module id="offline-view">
    <link rel="import" href="../style/theme.css" type="css">
    <link rel="import" href="../style/style.css" type="css">
    <template>
        <style>
            :host {
                display: block;
                padding-top: 326px;
            }

            .container {
                margin: auto;
                width: 525px;
                min-width: 326px;
                min-height: 274px;
                display: block;
            }

            .title {
                text-align: center;
                padding-top: 16px;
            }

            .text {
                padding: 64px;
                text-align: center;
            }

            @media (max-width: 728px) {
                :host {
                    padding-top: 36px;
                }

                .container {
                    width: 100%;
                }
            }

        </style>

        <paper-material class="container center-box" id="container" elevation="3">
            <div class="title">
                <h4>Server offline</h4>
            </div>

            <mega-loader class="loader" text="Connecting.." enabled="[[connecting]]"></mega-loader>

            <template is="dom-if" if="[[!connecting]]">
                <div class="text">
                    No connection available, we'll retry soon!
                </div>
            </template>
        </paper-material>

    </template>
</dom-module>

<script>
    class OfflineView extends Polymer.GestureEventListeners(Polymer.Element) {

        static get is() {
            return 'offline-view';
        }

        ready() {
            super.ready();
            this.connecting = false;

            application.subscribe('view', view => {
                if (view === 'offline-view') {
                    this.timer = setTimeout(() => {
                        this.connecting = true;
                        window.location.reload();
                    }, 5000);
                } else {
                    if (this.timer) {
                        window.clearInterval(this.timer);
                    }
                }
            });
        }
    }

    window.customElements.define(OfflineView.is, OfflineView);

</script>
