<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">

<!--
    @author Robin Duda
    Polymer element for a simple admin-panel using iron-pages.
 -->

<dom-module id="stats-view">
    <link rel="import" href="../style/theme.css" type="css">
    <link rel="import" href="../style/style.css" type="css">
    <template>
        <style>
            :host {
                display: block;
                font-family: 'Open Sans', sans-serif;
            }

            .container {
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
            }

            .attribute-wide {
                display: flex;
                width: 25%;
                margin-left: 12.5%;
                margin-right: 12.5%;
                flex-direction: row;
                justify-content: space-between;
            }

            .attribute-compact {
                display: flex;
                width: 100%;
                margin-left: 20%;
                margin-right: 20%;
                flex-direction: row;
                justify-content: space-between;
            }

            .penalty {
                color: #ff0000;
            }

            .bonus {
                color: #00ff00;
            }

            .content {
                font-size: 12px;
            }

        </style>

        <div class="container">
            <template is="dom-repeat" items="[[_toList(selected.stats.*)]]" as="attribute">
                <template is="dom-if" if="[[_visible(attribute)]]">
                    <div class$="content [[_layout(compact)]]">
                        <span class="name">[[attribute.name]]</span>
                        <span class$="value [[_style(attribute)]]">
                        <i>[[_format(attribute.value)]]</i>
                    </span>
                    </div>
                </template>
            </template>
        </div>

    </template>
</dom-module>
<script>
    class StatsView extends Polymer.GestureEventListeners(Polymer.Element) {

        constructor() {
            super();
            this.compact = false;
            this.hide = ['level', 'nextlevel', 'maxhealth', 'maxenergy', 'experience', 'energy', 'health'];
        }

        static get is() {
            return 'stats-view';
        }

        static get properties() {
            return {
                compact: {
                    type: Boolean,
                    value: false
                }
            }
        }

        _layout() {
            return 'attribute-' + ((this.compact) ? 'compact' : 'wide');
        }

        _visible(attribute) {
            return !this.hide.includes(attribute.name);
        }

        _format(value) {
            if (value < 0) {
                return value;
            } else {
                return `+${value}`;
            }
        }

        _style(attribute) {
            if (attribute.value < 0) {
                return "penalty";
            } else {
                return "bonus";
            }
        }

        _toList() {
            let stats = [];

            if (this.selected && this.selected.stats) {
                Object.keys(this.selected.stats).forEach((key, index) => {
                    stats.splice(index, 0, {
                        name: key,
                        value: this.selected.stats[key].toFixed(0)
                    });
                });
            }
            return stats;
        }

        update(character) {
            this.set('selected', character);
            this.notifyPath('selected.stats');
        }
    }

    window.customElements.define(StatsView.is, StatsView);
</script>
