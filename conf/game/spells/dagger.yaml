---
name: "Dagger"
description: "Strikes nearby targets with a dagger dealing ${this.character.stats.dexterity * 2 + this.character.stats.level} direct damage. Deals 50% bonus damage if target stands still."
cooldown: 0.5
casttime: 0.20
recharge: 3
charges: 5
animation:
  casting: "throw"
target: caster
onCastBegin:
  groovy: |
    RANGE = 428
    aoe = source.vector.copy().setSize(RANGE);
    in_range = game.creatures().radius(aoe).size() > 1;
    return in_range && spells.energy(source, -20);
onCastComplete:
  groovy: |
    import com.codingchili.instance.model.stats.Attribute;
    import com.codingchili.instance.model.spells.ModifierType;

    log.accept('casting dagger completed');

    RANGE = 428
    aoe = source.vector.copy().setSize(RANGE);

    damage = (source.stats[Attribute.dexterity] * -2) - (source.stats[Attribute.level] * 1);
    game.creatures().radius(aoe).collect().each { creature ->
      if (!creature.equals(source)) {
        amplify = (creature.vector.velocity == 0);
        amplifier = (amplify) ? 1.5 : 1.0;

        spells.damage(source, creature)
          .physical(damage * amplifier)
          .critical(amplify)
          .effect("dagger")
          .apply();
      }
    }